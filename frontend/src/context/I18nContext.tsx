import React, { createContext, useContext, useEffect, useMemo, useState } from 'react'

export type Lang = 'en' | 'am'

type Dict = Record<string, string>

const strings: Record<Lang, Dict> = {
  en: {
    'nav.home': 'Home',
    'nav.survey': 'Survey',
    'nav.admin': 'Admin',
    'nav.toggle_lang': '\u12a0\u121b',

    'landing.headline': 'Welcome to EEU Employee Survey Portal',
    'landing.subheadline': 'Your voice powers our future. Take 5 minutes to share your feedback.',
    'landing.cta': 'Start Survey',
    'landing.cta_aria': 'Start the survey',
    'landing.section_title': 'Why your feedback matters',
    'landing.section_body': 'We continuously improve employee experience at Ethiopian Electric Utility. Your insights guide better tools, processes, and culture. Responses are anonymous and analyzed to help make EEU a great place to work.',
    'landing.footer': '\u00a9 2025 Ethiopian Electric Utility. All rights reserved. Developed by EEU IT team.',

    'change_password.title': 'Change Password',
    'change_password.subtitle': 'Update your account password. This will affect how you log in next time.',
    'change_password.current': 'Current password',
    'change_password.new': 'New password',
    'change_password.confirm': 'Confirm new password',
    'change_password.submit': 'Change password',
    'change_password.changing': 'Changing...',
    'change_password.error.required_fields': 'Please fill in all fields.',
    'change_password.error.mismatch': 'New password and confirmation do not match.',
    'change_password.error.too_short': 'New password must be at least 8 characters long.',
    'change_password.error.weak': 'New password must contain both letters and numbers.',
    'change_password.error.current_incorrect': 'Current password is incorrect',
    'change_password.error.generic': 'Failed to change password.',
    'change_password.success': 'Password changed successfully.',

    'login.title': 'EEU Employee Survey Portal – Admin Access',
    'login.subtitle': 'Ethiopian Electric Utility — Employee Survey System',
    'login.username': 'Admin ID',
    'login.password': 'Password',
    'login.forgot': 'Forgot Password?',
    'login.secure': 'Secure access only',
    'login.submit': 'LOGIN',
    'login.authenticating': 'AUTHENTICATING…',

    'dashboard.title': 'Dashboard',
    'dashboard.active_survey': 'Active survey',
    'dashboard.total_responses': 'Total Responses',
    'dashboard.questions_rated': 'Questions Rated',
    'dashboard.recent_submissions': 'Recent Submissions',
    'dashboard.avg_ratings': 'Average Ratings',
    'dashboard.responses_over_time': 'Responses Over Time',
    'dashboard.rating_distributions': 'Rating Distributions',
    'dashboard.sentiment_overview': 'Sentiment Overview',
    'dashboard.rating_1': 'Very Dissatisfied',
    'dashboard.rating_2': 'Dissatisfied',
    'dashboard.rating_3': 'Neutral',
    'dashboard.rating_4': 'Satisfied',
    'dashboard.rating_5': 'Very Satisfied',
    'dashboard.no_active': 'No active survey',
    'dashboard.no_active_desc': 'Create and activate a survey to start collecting responses.',
    'dashboard.no_responses': 'No responses yet',
    'dashboard.no_responses_desc': 'Share the survey link and check back later.',
    'dashboard.no_rating_q': 'No rating questions found',

    'responses.title': 'Responses',
    'responses.export_csv': 'Export CSV',
    'responses.export_excel': 'Export Excel',
    'responses.export_pdf': 'Export PDF',
    'responses.filters': 'Filters',
    'responses.filters_applied': 'Filters applied',
    'responses.survey': 'Survey',
    'responses.from': 'From',
    'responses.to': 'To',
    'responses.question': 'Question',
    'responses.rating_min': 'Rating Min',
    'responses.rating_max': 'Rating Max',
    'responses.loading': 'Loading...',
    'responses.no_results': 'No responses found',
    'responses.prev': 'Prev',
    'responses.next': 'Next',

    'manage.title': 'Manage Surveys',
    'manage.new_survey': 'New Survey',
    'manage.created': 'Created',
    'manage.active': 'Active',
    'manage.inactive': 'Inactive',
    'manage.actions': 'Actions',
    'manage.edit': 'Edit',
    'manage.activate': 'Activate',
    'manage.delete': 'Delete',
    'manage.no_surveys': 'No surveys yet',
    'manage.create_title': 'Create Survey',
    'manage.title_label': 'Title',
    'manage.description_label': 'Description',
    'manage.make_active': 'Make Active',
    'manage.questions': 'Questions',
    'manage.add_question': 'Add Question',
    'manage.no_questions': 'No questions yet. Add at least one.',
    'manage.type': 'Type',
    'manage.rating': 'Rating (1-5)',
    'manage.text': 'Text',
    'manage.remove': 'Remove',
    'manage.cancel': 'Cancel',
    'manage.create': 'Create',
    'manage.set_active': 'Set Active',
    'manage.save': 'Save',
    'manage.drag_to_reorder': 'Drag to reorder',
    'manage.required_text': 'Question text is required',
    'manage.builder_preview': 'Preview',
    'manage.builder_required': 'Required',
    'manage.builder_duplicate': 'Duplicate',
    'manage.builder_save_draft': 'Save Draft',
    'manage.builder_publish': 'Publish Survey',
    'manage.builder_question_count': 'questions',
    'manage.builder_question_count_single': 'question',
    'manage.builder_type_dropdown': 'Dropdown',
    'manage.builder_type_multiple_choice': 'Multiple Choice',
    'manage.builder_type_linear_scale': 'Linear Scale',
    'manage.builder_type_paragraph': 'Paragraph',
    'manage.builder_type_rating': 'Rating',
    'manage.builder_type_regions': 'Regions',
    'manage.builder_type_text': 'Short text',
    'manage.builder_options_label': 'Options (one per line)',
    'manage.builder_min_label': 'Min label',
    'manage.builder_max_label': 'Max label',
    'manage.builder_options_placeholder': 'Option 1\\nOption 2',
    'manage.builder_min_placeholder': 'Very Dissatisfied',
    'manage.builder_max_placeholder': 'Very Satisfied',
    'manage.builder_edit_subtitle': 'Edit survey builder for',
    'manage.builder_add_question': 'Add question',
    'survey.preview_banner': 'Preview mode – responses will not be submitted.',

    'survey.header_title': 'EEU Employee Survey 2025',
    'survey.header_subtitle': 'Your anonymous feedback helps us improve. ~5 minutes',
    'survey.footer_page': 'Page',
    'survey.footer_of': 'of',
    'survey.action_back': 'Back',
    'survey.action_next': 'Next',
    'survey.action_submit': 'Submit',
    'survey.action_close_preview': 'Close Preview',

    'users.title': 'User Management',
    'users.new_user': 'New User',
    'users.cancel': 'Cancel',
    'users.create_user': 'Create User',
    'users.username': 'Username',
    'users.password': 'Password',
    'users.role': 'Role',
    'users.id': 'ID',
    'users.actions': 'Actions',
    'users.loading': 'Loading users...',
    'users.empty': 'No users found.',
    'users.edit': 'Edit',
    'users.reset_password': 'Reset Password',
    'users.delete': 'Delete',
    'users.reset_modal_title': 'Reset Password',
    'users.reset_modal_new_password': 'New password',
    'users.reset_modal_reset': 'Reset',
    'users.error.required_user_pass': 'Username and password are required.',
    'users.error.required_new_password': 'New password is required.',
    'users.error.self_delete': 'You cannot delete your own account.',
    'users.error.load_failed': 'Failed to load users.',
    'users.error.create_failed': 'Failed to create user.',
    'users.error.update_failed': 'Failed to update user.',
    'users.error.delete_failed': 'Failed to delete user.',
    'users.error.reset_failed': 'Failed to reset password.',
    'users.confirm.delete': 'Are you sure you want to delete this user?',
  },
  am: {
    'nav.home': 'መነሻ',
    'nav.survey': 'የጥናት መለኪያ',
    'nav.admin': 'አድሚን',
    'nav.toggle_lang': 'EN',

    'landing.headline': 'አንኳን ወደ የኢትዮጵያ ኤሌክትሪክ አገልግሎት የሰራተኞች የዳሰሳ ጥናት ገጽ በደህና መጡ።',
    'landing.subheadline': 'ድምጽዎ የወደፊታችን ኃይል ነው። አስተያየቶን ለማካፈል 5 ደቂቃ ይውሰዱ።',
    'landing.cta': 'የዳሰሳ ጥናቱን ይጀምሩ',
    'landing.cta_aria': 'መለኪያውን ጀምር',
    'landing.section_title': 'የእርስዎ አስተያየት አስፈላጊነት',
    'landing.section_body': 'በኢትዮጵያ ኤሌክትሪክ አገልግሎት የሰራተኛውን ልምድን በተከታታይ እናሻሽላለን። የእርስዎ አስተያየቶች እና ምላሾች የተሻሉ መሳሪያዎችን፣ ሂደቶችን እና ባህልን ይመራል። ምላሾች ስም-አልባ ናቸው። ኢኢዪን ጥሩ የስራ ቦታ ለማድረግ እንዲረዳን ግብአቶች ናቸው።',
    'landing.footer': '\u00a9 2025 ኢትዮጵያ ኤሌክትሪክ ዩቲሊቲ። መብቱ ሁሉ የተጠበቀ ነው። በኢኢዩ አይቲ ቡድን የበለፀገ።',

    'login.title': 'የኢትዮጵያ ኤሌክትሪክ አገልግሎት የሰራተኞች የዳሰሳ ጥናት ፖርታል – የአድሚን መዳረሻ',
    'login.subtitle': 'ኢትዮጵያ ኤሌክትሪክ ዩቲሊቲ — የሰራተኞች የዳሰሳ ጥናት ስርዓት',
    'login.username': 'አድሚን መለያ',
    'login.password': 'የይለፍ ቃል',
    'login.forgot': 'የይለፍ ቃል ረሱ?',
    'login.secure': 'ደህንነቱ የተጠበቀ መዳረሻ ብቻ',
    'login.submit': 'መግባት',
    'login.authenticating': 'በማረጋገጥ ላይ…',

    'dashboard.title': 'ዳሽቦርድ',
    'dashboard.active_survey': 'ንቁ የጥናት መለኪያ',
    'dashboard.total_responses': 'ጠቅላላ መልሶች',
    'dashboard.questions_rated': 'የተደረጉ ጥያቄዎች',
    'dashboard.recent_submissions': 'ቅርብ ማቅረቦች',
    'dashboard.avg_ratings': 'አማካይ ደረጃ',
    'dashboard.responses_over_time': 'ምላሾች በጊዜ',
    'dashboard.rating_distributions': 'የደረጃ ስርጭት',
    'dashboard.sentiment_overview': 'የአመለካከት አጠቃላይ እይታ',
    'dashboard.rating_1': 'በጣም አልረካሁም',
    'dashboard.rating_2': 'አልረካሁም',
    'dashboard.rating_3': 'መካከለኛ',
    'dashboard.rating_4': 'ረክቻለሁ',
    'dashboard.rating_5': 'በጣም ረክቻለሁ',
    'dashboard.no_active': 'ንቁ የጥናት መለኪያ የለም',
    'dashboard.no_active_desc': 'መረጃ ለመሰብሰብ መለኪያ ይፍጠሩና ያንቁት።',
    'dashboard.no_responses': 'እስካሁን ምላሽ የለም',
    'dashboard.no_responses_desc': 'መለኪያውን ያካፍሉ እና ዳግም ይመለሱ።',
    'dashboard.no_rating_q': 'የደረጃ ጥያቄዎች አልተገኙም',

    'responses.title': 'ምላሾች',
    'responses.export_csv': 'CSV ላክ',
    'responses.export_excel': 'Excel ላክ',
    'responses.export_pdf': 'PDF ላክ',
    'responses.filters': 'ማጣሪያዎች',
    'responses.filters_applied': 'ማጣሪያ ተተግብሯል',
    'responses.survey': 'መለኪያ',
    'responses.from': 'ከ',
    'responses.to': 'እስከ',
    'responses.question': 'ጥያቄ',
    'responses.rating_min': 'ዝቅተኛ ደረጃ',
    'responses.rating_max': 'ከፍተኛ ደረጃ',
    'responses.loading': 'በመጫን ላይ...',
    'responses.no_results': 'ምንም ምላሽ አልተገኘም',
    'responses.prev': 'ወደ ኋላ',
    'responses.next': 'ወደ ፊት',

    'manage.title': 'የዳሰሳ ጥናቶችን አስተዳድር',
    'manage.new_survey': 'አዲስ መለኪያ',
    'manage.created': 'ተፈጥሯል',
    'manage.active': 'ንቁ',
    'manage.inactive': 'እንቁ',
    'manage.actions': 'እርምጃዎች',
    'manage.edit': 'አርም',
    'manage.activate': 'አንቁ',
    'manage.delete': 'ሰርዝ',
    'manage.no_surveys': 'እስካሁን መለኪያ የለም',
    'manage.create_title': 'መለኪያ ፍጠር',
    'manage.title_label': 'ርዕስ',
    'manage.description_label': 'መግለጫ',
    'manage.make_active': 'ንቁ አድርግ',
    'manage.questions': 'ጥያቄዎች',
    'manage.add_question': 'ጥያቄ አክል',
    'manage.no_questions': 'ጥያቄ አልነበረም። ቢያንስ አንድ ያክሉ።',
    'manage.type': 'አይነት',
    'manage.rating': 'ደረጃ (1-5)',
    'manage.text': 'ጽሑፍ',
    'manage.remove': 'አስወግድ',
    'manage.cancel': 'ሰርዝ',
    'manage.create': 'ፍጠር',
    'manage.set_active': 'ንቁ አድርግ',
    'manage.save': 'አስቀምጥ',
    'manage.drag_to_reorder': 'ለመለወጥ ጎትት',
    'manage.required_text': 'ጥያቄ ጽሑፍ ያስፈልጋል',
    'manage.builder_preview': 'እይታ',
    'manage.builder_required': 'ተፈላጊ',
    'manage.builder_duplicate': 'አባዛ',
    'manage.builder_save_draft': 'ረቂቅ አስቀምጥ',
    'manage.builder_publish': 'መለኪያ አትም',
    'manage.builder_question_count': 'ጥያቄዎች',
    'manage.builder_question_count_single': 'ጥያቄ',
    'manage.builder_type_dropdown': 'ዝርዝር መረጫ',
    'manage.builder_type_multiple_choice': 'ብዙ ምርጫ',
    'manage.builder_type_linear_scale': 'የመስመር መለኪያ',
    'manage.builder_type_paragraph': 'አንቀጽ',
    'manage.builder_type_rating': 'ደረጃ',
    'manage.builder_type_regions': 'ክልል',
    'manage.builder_type_text': 'አጭር ጽሑፍ',
    'manage.builder_options_label': 'አማራጮች (እያንዳንዱ በመስመር)',
    'manage.builder_min_label': 'ዝቅተኛ መጠን',
    'manage.builder_max_label': 'ከፍተኛ መጠን',
    'manage.builder_options_placeholder': 'አማራጭ 1\\nአማራጭ 2',
    'manage.builder_min_placeholder': 'በጣም አልተደሰተም',
    'manage.builder_max_placeholder': 'በጣም ተደስቻለሁ',
    'manage.builder_edit_subtitle': 'የመለኪያ መገናኛ አርም ለ',
    'manage.builder_add_question': 'ጥያቄ አክል',
    'survey.preview_banner': 'የቅድመ እይታ ሁነታ – ምላሾች አይቀርቡም።',

    'survey.header_title': 'የኢኢዩ የሰራተኞች ዳሰሳ ጥናት 2025',
    //survey.header_subtitle': 'ስም-አልባ አስተያየትዎ እንድንሻሻል ይረዳናል። ~5 ደቂቃ',
    'survey.footer_page': 'ገጽ',
    'survey.footer_of': 'ከ',
    'survey.action_back': 'ወደ ኋላ',
    'survey.action_next': 'ቀጣይ',
    'survey.action_submit': 'አስገባ',
    'survey.action_close_preview': 'ቅድመ እይታን ዝጋ',

    'users.title': 'የተጠቃሚ አስተዳደር',
    'users.new_user': 'አዲስ ተጠቃሚ',
    'users.cancel': 'ሰርዝ',
    'users.create_user': 'ተጠቃሚ ፍጠር',
    'users.username': 'የተጠቃሚ ስም',
    'users.password': 'የይለፍ ቃል',
    'users.role': 'ሚና',
    'users.id': 'መለያ',
    'users.actions': 'እርምጃዎች',
    'users.loading': 'ተጠቃሚዎችን በመጫን ላይ...',
    'users.empty': 'ተጠቃሚ የለም።',
    'users.edit': 'አርም',
    'users.reset_password': 'የይለፍ ቃል እንደገና አዘምን',
    'users.delete': 'ሰርዝ',
    'users.reset_modal_title': 'የይለፍ ቃል እንደገና አዘምን',
    'users.reset_modal_new_password': 'አዲስ የይለፍ ቃል',
    'users.reset_modal_reset': 'እንደገና አዘምን',
    'users.error.required_user_pass': 'የተጠቃሚ ስምና የይለፍ ቃል ያስፈልጋል።',
    'users.error.required_new_password': 'አዲስ የይለፍ ቃል ያስፈልጋል።',
    'users.error.self_delete': 'የራስዎን መለያ ማጥፋት አይቻልም።',
    'users.error.load_failed': 'ተጠቃሚዎችን መጫን አልተሳካም።',
    'users.error.create_failed': 'ተጠቃሚ መፍጠር አልተሳካም።',
    'users.error.update_failed': 'ተጠቃሚ ማዘመን አልተሳካም።',
    'users.error.delete_failed': 'ተጠቃሚ ማጥፋት አልተሳካም።',
    'users.error.reset_failed': 'የይለፍ ቃል እንደገና ማዘመን አልተሳካም።',
    'users.confirm.delete': 'ይህንን ተጠቃሚ ማጥፋት እርግጠኛ ነዎት?',
  },
}

type Ctx = {
  lang: Lang
  setLang: (l: Lang) => void
  t: (key: string) => string
}

const I18nContext = createContext<Ctx | undefined>(undefined)

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [lang, setLang] = useState<Lang>(() => (localStorage.getItem('eeu_lang') as Lang) || 'en')

  useEffect(() => {
    localStorage.setItem('eeu_lang', lang)
    document.documentElement.lang = lang === 'am' ? 'am' : 'en'
  }, [lang])

  const t = useMemo(() => (key: string) => {
    const dict = strings[lang]
    return dict[key] ?? strings.en[key] ?? key
  }, [lang])

  const value = useMemo(() => ({ lang, setLang, t }), [lang, t])
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>
}

export function useI18n() {
  const ctx = useContext(I18nContext)
  if (!ctx) throw new Error('useI18n must be used within I18nProvider')
  return ctx
}
